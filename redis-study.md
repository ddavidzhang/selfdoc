# 大话自我学习与Redis

## 学习与面试

"吆，看快排啊，准备换工作啊？"，这种问候在同事之前再常见不过，俗称"临阵磨枪不快也光"，很多技术人知识储备最充足的时刻就是找工作的那段时间，为了应付面试，
各种八股文要重新过一遍，算法题过一遍，就怕面试时候忘掉某个知识点错失工作机会。
临时抱佛脚背死记硬背八股肯定是不可取的，花一两周时间看书学习准备，对面试是有效果的，但实际这种学习方式对知识的掌握上仍然是不够的，毕竟纸上得来终觉浅，绝知此事要躬行。
是的，很多知识只有我们认真实践过，才会深刻的印在脑海里，才会真正的掌握，才会真正的理解。否则，面试时我们不过是书本知识的转述，缺乏自己的思考，特别容易信心不足。

计算机基础知识也很多，就后台开发来说，面试经常问的如mysql、redis等存储知识自不必说，高深点的还会包括共识算法、事务等分布式知识，而大部分相关的知识对于一般的
业务开发来说只是了解过，平时很难有机会真正的实践过。我之前一直认为技术的学习要基于平时的工作，只有工作的实践才能更好的理解技术。但就我工作10几年的经验来看，有机会
去实践这些"面试中造火箭"的技术的机会极少，运气好遇到业务发展好的项目还多少能感觉一下高并发，而多数情况下作为业务开发真的就是螺丝钉，拧螺丝需要啥高深技术。

最近，我慢慢有了一些与之前不同的理解：

- 多数情况下很可能技术的学习还是要以自己业余项目为主，工作为辅
- 不要小看自己，工作中拧螺丝的人，业余时间一样可以自己实践造火箭的技术

我之前一直认为高大上的一些技术，什么高并发高可用，什么分布式事务，什么共识算法，真正自己在去实践的时候会发现其实并不是那么难，关键可以参考这几步： 

1.试用，体验，粗略的阅读一些入门文章，做到基本了解 
2.思考并罗列自己不理解或感兴趣的地方，查阅官方技术文档，理解底层技术原理
3.有重点的翻阅源码，带着问题验证一些具体实现细节，有必要时修改源码，验证自己的理解

下面我以redis为例，记录一下自己的学习过程，希望能对大家有所帮助。

## Redis学习总结

### 入门了解

对于工作十余年的我来说，试用体验大可不必了，但我还是搜了几篇redis相关的知识总结文章，主要是想大概回顾一下相关的一些基础概念和知识点。Redis的文章网络上简直是不要太多，
相信大家在面试前也都会看一些，但正如上面所说，这样的文章就是纸上谈兵，对于面试来说，这些文章只能起到一个复习的作用，真正的理解还是要自己去实践。
写的还比较全面的文章这里简单推荐一下：[面渣逆袭：Redis连环五十二问，图文详解，这下面试稳了！](https://zhuanlan.zhihu.com/p/509822426)，不建议大家花太多时间去研究这种总结性的文章，
只是起一个入门引路的作用，为下一步的学习做准备。

### 技术文档阅读    

通过上一步基本了解，首先我发现了一些redis比较经典的书籍，如黄建宏老师的《Redis设计与实现》，本书按数据结构与对象、单机数据库实现、多机数据库实现、独立功能实现等四个部分讲解，相对比较系统了，
另外黄老师有一篇文章[如何阅读 Redis 源码？](https://blog.huangz.me/diary/2014/how-to-read-redis-source-code.html)，对于阅读redis源码有很大的指导意义，当然有一个问题是这本书是2014年出版的，
redis的版本已经更新了很多，但基本的东西是够的，如果需要进一步学习redis新版本的一些特性，可以参考官方文档，官方文档的地址是：[https://redis.io/documentation](https://redis.io/documentation)，

最近我是一直在研究存储系统的，包括rosedb、mysql、tidb等，所以对于redis在相关技术点上的实现就比较感兴趣，包括持久化、事务等，相对在多机部署等高可用方面的兴趣就偏弱一些。通过思考我罗列了下面几个兴趣点：
1. 为什么redis不会直接用来做持久化存储？aof or rdb，对比其他db
2. 怎么理解redis单线程？
3. redis的内存数据结构实现
《Redis设计与实现》，我只是简要的看了一遍，主要的关注点更多的在redis某些实现的原理及原因上。

#### 字典，哈希    

1、用函数指针实现类似不同类型的多台
2、哈希表用链地址法解决冲突，冲突很多时效率会是问题
3、根据负载因子进行rehash，扩展或者收缩，ht[0]与ht[1]轮换
4、rehash的扩展在redis持久化过程中会放宽，尽量不进行rehash，避免内存操作影响持久化子进程的写时复制优化，最大限度的节约内存。
5、为了保证rehash处理大量数据，redis进行渐进式rehash，通过维护两个hash逐渐的将所有键值迁移到新的hash

#### 键过期

定时、定期、懒惰删除等，主要考虑如何高效使用cpu，避免过多的消耗cpu资源

#### redis对象

类似面向对象的思想通过对象实现多态，
关于[写时复制](https://zhuanlan.zhihu.com/p/136428913)
写入时复制（英语：Copy-on-write，简称COW）是一种计算机程序设计领域的优化策略。其核心思想是，如果有多个调用者（callers）同时请求相同资源（如内存或磁盘上的数据存储），他们会共同获取相同的指针指向相同的资源，直到某个调用者试图修改资源的内容时，系统才会真正复制一份专用副本（private copy）给该调用者，而其他调用者所见到的最初的资源仍然保持不变。

#### 持久化

redis作者写的文章，[解密Redis持 久化](https://blog.csdn.net/jackpk/article/details/30079925)
rdb模式效率更高，但实时性不好，aof数据安全性上不比mysql等传统数据库差。aof的重写机制，避免aof过分的增长对服务器的性能压力。
4.0加入了混合持久化，正是自己所想的那样：大数据量用rdb，新增量数据用ao

#### 线程模型

早期单进程单线程，4.0 除主线程外，后台线程处理一些如清理脏数据、无用链接释放、大key的删除等缓慢的操作，6.0 多线程处理网络io数据的读写和协议解析，命令执行仍然是单线程。redis的性能瓶颈在网络IO而非cpu，使用多线程提提升IO读写的效率，提高redis整体的性能。

### 源码阅读

为了阅读源码我专门回顾了一下c语言的基本语法，10年前的学生时代学过c++，所以复习起来也相对容易，不过c中对于宏的一些使用还真是让自己着实捏一把汗。
源码的阅读参考黄老师的阅读建议及带注释的源码仓库，针对性的对以上感兴趣的知识点进行阅读学习，很多相关的技术点自己甚至可以去修改源码然后进行验证，源码在手随便造的感觉真的很爽，这比简单的阅读文档要有意思的多。

### 总结

自主学习的过程最大的阻力是丧失动力，因为没有人监督，没有人辅导，甚至学好学坏很难有直接的反馈，对于如何解决动力上的问题，我有以下几点建议(github copilot生成)：
- 1、找到自己的兴趣点，不要盲目的学习，有目的的学习，这样学习起来才有动力，而且学习的效率也会更高
- 2、找到学习的方法，不要一味的去看书，看视频，这样效率很低，可以通过阅读源码，写demo等方式来学习，这样学习起来更有成就感
- 3、找到学习的节奏，不要一味的追求速度，这样容易疲惫，可以适当的放慢节奏，这样学习起来更有质量
- 4、找到学习的伙伴，不要一味的自己学习，这样容易失去动力，可以找到志同道合的伙伴一起学习，这样学习起来更有动力

顺便说下，我发现用copilot写文章也是个不错的选择，github建个项目，然后在有copilot的ide环境编辑，这样写文章也是一种享受。
