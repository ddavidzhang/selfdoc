# boltdb学习总结
## 1. boltdb简介
boltdb是一个纯go编写的支持事务的文件型单机kv数据库，整个仓库完全基于go基础库，没有任何其他第三方库依赖，代码只有3000行左右，简单、稳定、高效，如果想深入学习B+tree存储引擎，
boltdb是一个很理想的学习对象。

## 2. boltdb物理存储形式
在boltdb中，一个db对应一个独立的磁盘文件，随数量变大而成倍增长。文件中，数据以page为单位来读取和写入，所有的数据在磁盘上都是按照页(page)来存储的，页大小是保持和操作系统对应的内存页大小一致，默认4k。
进程启动初始化时会进行内存映射(mmap)，将文件中的数据映射到内存中的一段连续空间，后续再读取某一页的数据时，直接在内存中读取，具体参考内存映射的原理。而写数据页为避免mmap写大文件的性能问题，采用的是普通的文件IO。
根据存储内容不同，page分为四种不同类型，对应四种内存结构，完成四种内存结构的物理页存储。
四种内存结构包括元数据，空闲列表，非叶子节点，叶子节点；对应元数据页，空闲列表页，非叶子节点页，叶子节点页共四种页类型，每种类型的页在读取和写入磁盘时，与page页结构实现相互转换（很像序列化是不是），转换过程包含大量的go byte 指针操作。

数据模型：
在boltdb中，索引和数据时按照b+树来组织。其中，一个bucket(类似mysql table)对应一颗b+树，叶子节点存储具体的数据，非叶子节点只存储具体的索引信息，类似mysql innodb中的主键索引结构。不同的是，mysql的非主键索引叶子节点存储的是主键的索引，而boltdb作为kv数据库不需要这种二级索引结构。同时值得小注意的是所有的bucket也构成了一颗树，但该树不是b+树。

